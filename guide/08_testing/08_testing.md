# 08 テスト

アプリケーションの品質と保守性を高く保つために、テストは不可欠なプロセスです。この章では、Spockフレームワークを中心としたテスト戦略と、ArchUnitによるアーキテクチャの健全性を保つためのテストについて解説します。

## 📋 章の構成

### 8.1 🎯 テスト戦略の概要
- [08_testing_overview.md](08_testing_overview.md)
  - テストピラミッドの理解
  - 各層でのテスト戦略
  - テストの自動化と継続的品質保証
  - テストカバレッジの測定

### 8.2 🧪 Spockフレームワークの基本
- [08_spock_basics.md](08_spock_basics.md)
  - BDDスタイルのテスト記述
  - given-when-then構造
  - パラメータ化テスト
  - モックとスタブの基本

### 8.3 🔬 ユニットテスト
- [08_unit_test.md](08_unit_test.md)
  - ドメインオブジェクトのテスト
  - アプリケーションサービスのテスト
  - モックとスタブの活用
  - テストデータの準備

### 8.4 🔗 インテグレーションテスト
- [08_integration_test.md](08_integration_test.md)
  - Spring Boot Testの活用
  - REST APIエンドポイントのテスト
  - 認証・認可のテスト
  - データベース統合テスト
  - **ログ出力のテスト**
  - **セキュリティテスト（CSRF保護、レート制限）**
  - **CI/CD統合（GitHub Actions）**
  - **パフォーマンステスト**
  - **エラーハンドリングのテスト**

### 8.5 🏗️ アーキテクチャテスト
- [08_architecture_test.md](08_architecture_test.md)
  - ArchUnitによる依存関係チェック
  - オニオンアーキテクチャの検証
  - レイヤー間の境界テスト
  - 設計原則の検証

### 8.6 🐳 Testcontainersによるテスト
- [08_testcontainers.md](08_testcontainers.md)
  - Spannerエミュレータの活用
  - Singleton Container Pattern
  - 効率的なインテグレーションテスト
  - 複数コンテナの連携

### 8.7 📊 テストデータ管理
- [08_test_data.md](08_test_data.md)
  - テストフィクスチャの設計
  - テストデータのクリーンアップ
  - テストの独立性確保
  - ファクトリパターンの活用

## 🎯 学習のポイント

### 1. **テストファーストの考え方**
- 品質を保証するためのテスト駆動開発
- リファクタリングの安全性確保
- 設計の改善とバグの早期発見

### 2. **適切なテストレベル**
- ユニット、インテグレーション、アーキテクチャテストの使い分け
- テストピラミッドに基づく戦略
- 各層でのテスト重点項目

### 3. **テストの保守性**
- 読みやすく、理解しやすいテストコードの作成
- テストデータの管理と再利用
- テストの独立性と実行速度

### 4. **自動化の重要性**
- CI/CDパイプラインでの継続的テスト実行
- テスト結果の可視化とレポート
- 品質ゲートの設定

### 5. **ログテストの重要性**
- アプリケーションの動作追跡
- 重要なビジネスイベントの記録確認
- セキュリティイベントのログ検証
- デバッグ支援と監査証跡

## 📚 実装例

この章では、以下のテストパターンとコンポーネントを実装します：

### テストフレームワーク
- **Spock Framework**: BDDスタイルのテスト記述
- **Testcontainers**: コンテナベースのテスト環境
- **ArchUnit**: アーキテクチャテスト
- **Spring Boot Test**: 統合テスト

### テストパターン
- **ユニットテスト**: ドメインオブジェクト、アプリケーションサービス
- **インテグレーションテスト**: REST API、データベース、メッセージング
- **ログテスト**: ログキャプチャ、ログ検証、ログレベル確認
- **セキュリティテスト**: CSRF保護、レート制限、認証・認可
- **パフォーマンステスト**: レスポンス時間、メモリ使用量
- **アーキテクチャテスト**: 依存関係、命名規則、設計原則
- **E2Eテスト**: エンドツーエンドのテストシナリオ

### テストデータ管理
- **TestDataFactory**: テストデータのファクトリ
- **TestDataBuilder**: ビルダーパターンによるテストデータ構築
- **TestDataCleanup**: テストデータのクリーンアップ
- **TestDataIsolation**: テストの独立性確保

### ログテスト機能
- **LoggingTestHelper**: ログ検証のヘルパークラス
- **ListAppender**: ログキャプチャ機能
- **ログレベル検証**: INFO、WARN、ERRORレベルの確認
- **ログメッセージ検証**: ビジネスイベントの記録確認

## 🔄 次のステップ

次の章では、これまでの学習内容をまとめ、実践的な開発プロセスについて解説します。アーキテクチャの進化と継続的改善についても触れます。 